<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Grid Map Editor</title>
    
    <!-- External CSS file -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Load Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="header-left">
            <button id="help-btn">Help</button>
        </div>
        <h1>Interactive Route Optimization Map</h1>
        <div class="header-right"></div>
    </header>

    <div class="main-container">
        
        <!-- Left Panel: 2D "Pixel Block" Editor -->
        <div class="editor-panel">
            <h2>2D "Pixel Block" Editor</h2>
            <p>Click any square to toggle it. In <strong>Build Mode</strong>, you can click and drag to "paint" or "erase" obstacles.</p>
            
            <div id="grid-editor-container"></div>
            
            <div id="pathfinding-controls">
                <h3>Multi-Stop Pathfinding</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" id="btn-build" data-mode="BUILD">Build Mode</button>
                    <button class="mode-btn" id="btn-start" data-mode="SET_START">Set Start</button>
                    <button class="mode-btn" id="btn-stop" data-mode="SET_STOP">Add/Remove Stop</button>
                </div>
                <button id="find-path-btn">Find Optimal Route (A*)</button>
                <div id="message-box"></div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #444444;"></div>
                    <span>Path (Walkable)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #cccccc;"></div>
                    <span>Obstacle (Building)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4CAF50;"></div>
                    <span>Start Point</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #F44336;"></div>
                    <span>Stop Point</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #00E676;"></div>
                    <span>Stop (Completed)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #00BCD4;"></div>
                    <span>Calculated Path</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #00BFFF;"></div>
                    <span>Animation Sphere</span>
                </div>
            </div>
        </div>

        <!-- Right Panel: 3D Map Visualization -->
        <div class="canvas-container">
            <canvas id="three-canvas"></canvas>
            <div id="label-container"></div>
        </div>

    </div>

    <!-- Startup Modal -->
    <div id="startup-modal">
        <div class="modal-content">
            <h2>Set Grid Size</h2>
            <div class="modal-inputs">
                <div>
                    <label for="input-rows">Rows (5-50)</label>
                    <input type="number" id="input-rows" value="15" min="5" max="50">
                </div>
                <div>
                    <label for="input-cols">Columns (5-50)</label>
                    <input type="number" id="input-cols" value="15" min="5" max="50">
                </div>
            </div>
            <button id="start-btn">Start Building</button>
        </div>
    </div>
    
    <!-- Tutorial HTML -->
    <div id="tutorial-overlay">
        <div id="tutorial-step">
            <h3 id="tutorial-title">Welcome!</h3>
            <p id="tutorial-text">Let's learn how to use the app.</p>
            <div class="tutorial-nav">
                <span id="tutorial-counter">1 / 6</span>
                <div class="tutorial-nav-buttons">
                    <button id="tutorial-end">End</button>
                    <button id="tutorial-prev" disabled>&larr; Prev</button>
                    <button id="tutorial-next">Next &rarr;</button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Demo Cursor for Tutorial -->
    <div id="demo-cursor">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="black" stroke-width="1.5" style="transform: rotate(20deg);">
            <path d="M7.071 5.636a2 2 0 0 1 2.828 0l1.414 1.414a2 2 0 0 0 2.828 0l4.243-4.242a2 2 0 0 1 2.828 2.828L17 12.879a2 2 0 0 0 0 2.828l1.414 1.414a2 2 0 0 1 0 2.828l-1.414 1.414a2 2 0 0 1-2.828 0L12.879 17a2 2 0 0 0-2.828 0l-1.414 1.414a2 2 0 0 1-2.828 0L4.464 17a2 2 0 0 1 0-2.828l1.414-1.414a2 2 0 0 0 0-2.828L1.636 8.464a2 2 0 0 1 0-2.828L3 4.222a2 2 0 0 1 2.828 0L7.07 5.636z"/>
        </svg>
    </div>

    <!-- Three.js Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.167.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.167.0/examples/jsm/",
                "three/addons/renderers/CSS2DRenderer.js": "https://cdn.jsdelivr.net/npm/three@0.167.0/examples/jsm/renderers/CSS2DRenderer.js"
            }
        }
    </script>

    <!-- External JavaScript file -->
    <script type="module" src="main.js"></script>
</body>
</html>